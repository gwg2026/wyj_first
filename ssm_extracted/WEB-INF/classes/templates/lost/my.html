<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å‘å¸ƒ</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        .publish-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group textarea {
            resize: vertical;
            height: 100px;
        }
        .publish-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .publish-btn:hover {
            opacity: 0.9;
        }
        .toggle-form-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .toggle-form-btn:hover {
            background: #218838;
        }
        .form-container {
            display: none;
        }
        .form-container.show {
            display: block;
        }
        .item-actions {
            margin-top: 10px;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .delete-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div th:replace="fragments/navbar :: navbar" th:with="activePage='my'"></div>
    <div class="container">
        <div class="header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px;">
            <h2>æˆ‘çš„å‘å¸ƒ</h2>
        </div>
        
        <!-- é”™è¯¯ä¿¡æ¯æ˜¾ç¤º -->
        <div th:if="${error}" class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
            <span th:text="${error}"></span>
        </div>
        
        <!-- å‘å¸ƒå¤±ç‰©è¡¨å• -->
        <div class="publish-form" th:if="${!needLogin}">
            <button type="button" class="toggle-form-btn" onclick="togglePublishForm()">
                â• å‘å¸ƒæ–°çš„å¤±ç‰©ä¿¡æ¯
            </button>
            
            <div id="publishFormContainer" class="form-container">
                <h3 style="margin-bottom: 20px; color: #333;">å‘å¸ƒå¤±ç‰©ä¿¡æ¯</h3>
                <form th:action="@{/lost/publish}" method="post" enctype="multipart/form-data" id="publishForm">
                    <div class="form-group">
                        <label for="type">ç±»å‹ï¼š</label>
                        <select id="type" name="type" required>
                            <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                            <option value="1">å¤±ç‰©</option>
                            <option value="2">æ‹¾ç‰©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="categoryId">åˆ†ç±»ï¼š</label>
                        <select id="categoryId" name="categoryId" required>
                            <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                            <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">æ ‡é¢˜ï¼š</label>
                        <input type="text" id="title" name="title" placeholder="è¯·è¾“å…¥ç‰©å“æ ‡é¢˜" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">è¯¦ç»†æè¿°ï¼š</label>
                        <textarea id="description" name="description" placeholder="è¯·è¯¦ç»†æè¿°ç‰©å“çš„ç‰¹å¾ã€ä¸¢å¤±/æ‹¾åˆ°çš„æƒ…å†µç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="lostLocation">åœ°ç‚¹ï¼š</label>
                        <input type="text" id="lostLocation" name="lostLocation" placeholder="è¯·è¾“å…¥ä¸¢å¤±æˆ–æ‹¾åˆ°çš„å…·ä½“åœ°ç‚¹">
                    </div>
                    
                    <div class="form-group">
                        <label for="lostTimeStr">æ—¶é—´ï¼š</label>
                        <input type="datetime-local" id="lostTimeStr" name="lostTimeStr">
                    </div>
                    
                    <div class="form-group">
                        <label for="contactInfo">è”ç³»æ–¹å¼ï¼š</label>
                        <input type="text" id="contactInfo" name="contactInfo" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯æˆ–å…¶ä»–è”ç³»æ–¹å¼">
                    </div>
                    
                    <div class="form-group">
                        <label for="imageFile">å›¾ç‰‡ï¼š</label>
                        <input type="file" id="imageFile" name="imageFile" accept="image/*">
                        <small style="color: #666;">æ”¯æŒjpgã€pngç­‰æ ¼å¼ï¼Œå»ºè®®å›¾ç‰‡å¤§å°ä¸è¶…è¿‡2MB</small>
                    </div>
                    
                    <button type="submit" class="publish-btn">å‘å¸ƒä¿¡æ¯</button>
                </form>
            </div>
        </div>
        
        <!-- æˆ‘çš„å‘å¸ƒåˆ—è¡¨ -->
        <div class="items" th:if="${items != null and !items.isEmpty()}">
            <h3 style="margin-bottom: 20px; color: #333;">æˆ‘çš„å‘å¸ƒè®°å½•</h3>
            <div class="item-card" th:each="item : ${items}">
                <img th:if="${item.imageUrl != null}" th:src="@{${item.imageUrl}}" class="item-image" alt="å›¾ç‰‡">
                <div class="item-content">
                    <div class="item-title">
                        <a th:href="@{/lost/detail/{id}(id=${item.id})}" th:text="${item.title}"></a>
                        <span class="status-badge" th:classappend="${item.status == 1 ? 'status-found' : 'status-lost'}"
                              th:text="${item.status == 1 ? 'å·²æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}"></span>
                    </div>
                    <div class="item-meta">
                        <span class="type-badge" th:classappend="${item.type == 1 ? 'type-lost' : 'type-found'}"
                              th:text="${item.type == 1 ? 'å¤±ç‰©' : 'æ‹¾ç‰©'}"></span>
                        <span th:text="${item.category != null ? item.category.name : 'æœªåˆ†ç±»'}"></span>
                    </div>
                    <div class="item-meta" th:if="${item.lostLocation != null}">ğŸ“ <span th:text="${item.lostLocation}"></span></div>
                    <div class="item-meta">ğŸ‘ï¸ æµè§ˆ <span th:text="${item.viewCount}"></span> æ¬¡</div>
                    <div class="item-meta">ğŸ“… <span th:text="${#dates.format(item.createTime, 'yyyy-MM-dd HH:mm')}"></span></div>
                    <div class="item-actions">
                        <button class="delete-btn" th:onclick="'deleteItem(' + ${item.id} + ')'">åˆ é™¤</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç™»å½•æç¤º -->
        <div class="login-prompt" th:if="${needLogin}" style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px;">
            <h3 style="margin-bottom: 15px;">ğŸ”’ éœ€è¦ç™»å½•</h3>
            <p style="margin-bottom: 15px;">è¯·å…ˆç™»å½•åå†æŸ¥çœ‹æ‚¨çš„å‘å¸ƒè®°å½•å’Œå‘å¸ƒæ–°çš„å¤±ç‰©ä¿¡æ¯ã€‚</p>
            <a th:href="${loginUrl}" class="login-btn" style="background: #667eea; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;">
                ç«‹å³ç™»å½•
            </a>
        </div>
        
        <div class="empty" th:if="${!needLogin and (items == null or items.isEmpty())}">
            <p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•ä¿¡æ¯</p>
            <p style="color: #666; margin-top: 10px;">ç‚¹å‡»ä¸Šæ–¹çš„"å‘å¸ƒæ–°çš„å¤±ç‰©ä¿¡æ¯"æŒ‰é’®å¼€å§‹å‘å¸ƒå§ï¼</p>
        </div>
    </div>

    <script>
        function togglePublishForm() {
            const container = document.getElementById('publishFormContainer');
            container.classList.toggle('show');
        }
        
        function deleteItem(itemId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ä¿¡æ¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) {
                fetch('/lost/delete/' + itemId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('åˆ é™¤æˆåŠŸ');
                        location.reload();
                    } else {
                        alert('åˆ é™¤å¤±è´¥ï¼š' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
            }
        }
        
        // ç§»é™¤JavaScriptè¡¨å•æ‹¦æˆªï¼Œè®©è¡¨å•æ­£å¸¸æäº¤
        // è¡¨å•å°†é€šè¿‡æ­£å¸¸çš„POSTè¯·æ±‚æäº¤åˆ°åç«¯ï¼Œåç«¯å¤„ç†åé‡å®šå‘åˆ°/myé¡µé¢
    </script>
</body>
</html>

