<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­å¤±ç‰©æ‹›é¢†ç³»ç»Ÿ</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div th:replace="fragments/navbar :: navbar" th:with="activePage='list'"></div>
    <div class="container">
        <div class="search-box">
            <form class="search-form" th:action="@{/lost/search}" method="get">
                <input type="text" name="keyword" placeholder="è¾“å…¥å…³é”®å­—æœç´¢..." th:value="${keyword}">
                <select name="categoryId">
                    <option value="">å…¨éƒ¨åˆ†ç±»</option>
                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}" 
                            th:selected="${categoryId == cat.id}"></option>
                </select>
                <button type="submit">æœç´¢</button>
            </form>
        </div>
        <div class="items" th:if="${items != null and !items.isEmpty()}">
            <div class="item-card" th:each="item : ${items}">
                <div th:if="${item.imageUrl != null}" class="item-image-container">
                    <img th:src="@{${item.imageUrl}}" class="item-image" alt="å›¾ç‰‡" 
                         onerror="handleImageError(this)" th:title="${item.title}">
                </div>
                <div th:if="${item.imageUrl == null}" class="item-image-placeholder" 
                     style="background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; height: 200px;">
                    <div style="text-align: center; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“·</div>
                        <div>æš‚æ— å›¾ç‰‡</div>
                    </div>
                </div>
                <div class="item-content">
                    <div class="item-title">
                        <a th:href="@{/lost/detail/{id}(id=${item.id})}" th:text="${item.title}"></a>
                        <span class="item-status" th:classappend="${item.status == 1 ? 'status-found' : 'status-lost'}"
                              th:text="${item.status == 1 ? 'å·²æ‰¾åˆ°' : 'æœªæ‰¾åˆ°'}"></span>
                    </div>
                    <div class="item-meta">
                        <span class="item-type" th:classappend="${item.type == 1 ? 'type-lost' : 'type-found'}"
                              th:text="${item.type == 1 ? 'å¤±ç‰©' : 'æ‹¾ç‰©'}"></span>
                        <span th:text="${item.category != null ? item.category.name : 'æœªåˆ†ç±»'}"></span>
                    </div>
                    <div class="item-meta" th:if="${item.lostLocation != null}">ğŸ“ <span th:text="${item.lostLocation}"></span></div>
                    <div class="item-meta">ğŸ‘¤ <span th:text="${item.user != null ? item.user.realName : 'æœªçŸ¥'}"></span></div>
                    <div class="item-meta">ğŸ‘ï¸ æµè§ˆ <span th:text="${item.viewCount}"></span> æ¬¡ | 
                         <span th:text="${#dates.format(item.createTime, 'yyyy-MM-dd HH:mm')}"></span></div>
                </div>
            </div>
        </div>
        <div class="empty" th:if="${items == null or items.isEmpty()}">
            <p>æš‚æ— å¤±ç‰©ä¿¡æ¯</p>
        </div>
    </div>
    
    <script>
        // å›¾ç‰‡é”™è¯¯å¤„ç†å‡½æ•°
        function handleImageError(img) {
            console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', img.src);
            img.style.display = 'none';
            
            // åˆ›å»ºä¸€ä¸ªå ä½ç¬¦
            const placeholder = document.createElement('div');
            placeholder.style.cssText = `
                background: #f8f9fa;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 200px;
                border: 2px dashed #ddd;
            `;
            
            placeholder.innerHTML = `
                <div style="text-align: center; color: #999;">
                    <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“·</div>
                    <div>å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                </div>
            `;
            
            // æ›¿æ¢å›¾ç‰‡ä¸ºå ä½ç¬¦
            img.parentNode.replaceChild(placeholder, img);
        }
    </script>
</body>
</html>

